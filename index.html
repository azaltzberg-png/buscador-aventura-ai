<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adonait Business LLC | Real Estate AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0f172a; --accent: #c5a059; --light: #f8fafc; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; display: flex; height: 100vh; background: #f1f5f9; overflow: hidden; }
        
        /* Panel de b√∫squeda y filtros */
        #ui-panel { width: 420px; background: white; z-index: 100; box-shadow: 10px 0 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        
        .filter-area { padding: 15px; background: var(--light); border-bottom: 1px solid #e2e8f0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        select, input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 12px; }
        .full-width { grid-column: span 2; }
        
        button { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 700; transition: 0.3s; }
        button:hover { background: var(--accent); }

        /* Lista de resultados */
        #results { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .card { background: white; border-radius: 12px; border: 1px solid #eee; margin-bottom: 15px; cursor: pointer; overflow: hidden; transition: 0.2s; }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-info { padding: 10px; }
        .card-price { font-size: 1.2rem; font-weight: 700; color: var(--primary); }

        /* Ficha de Detalle (Modal) */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 800px; max-height: 90vh; border-radius: 20px; overflow-y: auto; position: relative; display: flex; flex-direction: column; }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 30px; cursor: pointer; color: white; background: var(--primary); width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; z-index: 10; }
        .modal-header img { width: 100%; height: 400px; object-fit: cover; }
        .modal-body { padding: 30px; }
        .broker-contact-box { background: var(--light); padding: 20px; border-radius: 15px; border-left: 5px solid var(--accent); margin-top: 20px; }

        #map { flex-grow: 1; }
        .ws-float { position: fixed; bottom: 20px; right: 20px; background: #25d366; color: white; padding: 15px 25px; border-radius: 50px; text-decoration: none; font-weight: 700; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="modal">
    <div class="close-modal" onclick="closeModal()">&times;</div>
    <div class="modal-content" id="modal-data"></div>
</div>

<a href="https://wa.me/19545887564" class="ws-float" target="_blank">Contactar a Alberto</a>

<div id="ui-panel">
    <div class="header">
        <h1 style="margin:0; font-size:1.1rem;">ADONAIT BUSINESS LLC</h1>
        <small style="color:var(--accent)">ALBERTO ZALTZBERG - BROKER</small>
    </div>

    <div class="filter-area">
        <input type="text" id="f-city" placeholder="Ciudad (Ej: Aventura)" class="full-width">
        <input type="text" id="f-zip" placeholder="ZIP Code">
        <select id="f-type">
            <option value="">Tipo Propiedad</option>
            <option value="Residential">Residencial</option>
            <option value="Condominium">Condominio</option>
        </select>
        <select id="f-transaction">
            <option value="Venta">Venta</option>
            <option value="Renta">Renta</option>
        </select>
        <input type="number" id="f-price" placeholder="Precio M√°x.">
        <button onclick="applyFilters()" class="full-width">BUSCAR AHORA</button>
    </div>

    <div id="results"></div>
</div>

<div id="map"></div>

<script>
    const BROWSER_TOKEN = 'ef52c732beb2036c9168768f7b5246cc';
    let map, markers = [], currentData = [];

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 25.9565, lng: -80.1392 },
            zoom: 13
        });
        applyFilters();
    }

    async function applyFilters() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = "Buscando...";
        
        let city = document.getElementById('f-city').value || 'Aventura';
        let zip = document.getElementById('f-zip').value;
        let price = document.getElementById('f-price').value;
        let trans = document.getElementById('f-transaction').value;

        // Construcci√≥n de consulta OData para miamire
        let query = `City eq '${city}' and MlsStatus eq 'Active'`;
        if(zip) query += ` and PostalCode eq '${zip}'`;
        if(price) query += ` and ListPrice le ${price}`;
        
        const url = `https://api.bridgedataoutput.com/api/v2/OData/miamire/Property?access_token=${BROWSER_TOKEN}&$filter=${encodeURIComponent(query)}&$top=20`;

        try {
            const resp = await fetch(url);
            const data = await resp.json();
            currentData = data.value;
            render(currentData);
        } catch (e) {
            resultsDiv.innerHTML = "Error al conectar. Verifica los filtros.";
        }
    }

    function render(props) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = "";
        markers.forEach(m => m.setMap(null));

        props.forEach((p, index) => {
            const pos = { lat: parseFloat(p.Latitude), lng: parseFloat(p.Longitude) };
            const marker = new google.maps.Marker({ position: pos, map: map });
            markers.push(marker);

            const card = document.createElement('div');
            card.className = 'card';
            const img = p.Media?.[0]?.MediaURL || 'https://via.placeholder.com/400x200';
            card.innerHTML = `
                <img src="${img}">
                <div class="card-info">
                    <div class="card-price">$${p.ListPrice.toLocaleString()}</div>
                    <div style="font-size:12px;">${p.UnparsedAddress}</div>
                </div>
            `;
            card.onclick = () => showDetail(index);
            resultsDiv.appendChild(card);
        });
    }

    function showDetail(index) {
        const p = currentData[index];
        const modal = document.getElementById('modal');
        const content = document.getElementById('modal-data');
        const img = p.Media?.[0]?.MediaURL || 'https://via.placeholder.com/800x400';

        content.innerHTML = `
            <div class="modal-header"><img src="${img}"></div>
            <div class="modal-body">
                <h2 style="color:var(--primary)">$${p.ListPrice.toLocaleString()}</h2>
                <p><b>Direcci√≥n:</b> ${p.UnparsedAddress}, ${p.City}, ${p.PostalCode}</p>
                <hr>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; font-size:14px;">
                    <div>üõèÔ∏è Hab: ${p.BedroomsTotal || 'N/A'}</div>
                    <div>üöø Ba√±os: ${p.BathroomsFullTotal || 'N/A'}</div>
                    <div>üìê SqFt: ${p.LivingArea || 'N/A'}</div>
                    <div>üè¢ A√±o: ${p.YearBuilt || 'N/A'}</div>
                </div>
                <p style="margin-top:20px; font-size:14px; line-height:1.6; color:#555;">${p.PublicRemarks || 'Sin descripci√≥n disponible.'}</p>
                
                <div class="broker-contact-box">
                    <h3 style="margin:0; color:var(--primary);">Interesado en esta propiedad?</h3>
                    <p style="margin:10px 0;">Contacta a <b>Alberto Zaltzberg</b> para una visita privada.</p>
                    <p>üìû <b>954-588-7564</b></p>
                    <a href="https://wa.me/19545887564?text=Hola Alberto, me interesa la propiedad en ${p.UnparsedAddress}" 
                       style="background:#25d366; color:white; padding:10px 20px; border-radius:8px; text-decoration:none; display:inline-block; font-weight:bold;">
                       Enviar WhatsApp
                    </a>
                </div>
            </div>
        `;
        modal.style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    window.onclick = (event) => { if (event.target == modal) closeModal(); }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCFDOG6McuD5d6JUUGi2g5ATLNa7LX1LrQ&callback=initMap" async defer></script>
</body>
</html>
